function swDS(mode) {
    "use strict";
    var dOpt = { desktop: "styles/fixed.css", mobile: "styles/fluid.css", print: "styles/print.css" };
    $.get(dOpt[mode], function (data) {
	 	$('head style[title="mediaOption"]').html(data);
    });
}

function swDML(link) {
		if(link.hasClass("ui-state-active defaultCursor")) { return ''; }
		link.removeClass("clickable").addClass("ui-state-active defaultCursor").parent().siblings("li").children("a").removeClass("ui-state-active defaultCursor").addClass("clickable");
		return link.text();
}

function findDS() {
	var link = $([]);
//	alert ($("#bioPhotoMobile").css("display") + " " + $("#bioPhotoDesktop").css("display"));
	if($(".bioPhotoMobile").css("display") !== "none") link = $(".sec_nav .mobile");
	else if($(".bioPhotoDesktop").css("display") !== "none") link = $(".sec_nav .desktop");
	else link = $(".sec_nav .print");
	swDML(link);    
}

/// The two functions below dynamically set the header font size
/// The font scales with the width of the browser window 

function setFontScale() {
	"use strict";
	var $body = $('body'),
		scaleSource = $body.width(),
		scaleFactor = 0.15,
		maxScale = 600,
		minScale = 113,
		fontSize = scaleSource * scaleFactor;
	if (fontSize > maxScale) {
		fontSize = maxScale;
	}
	if (fontSize < minScale) {
		fontSize = minScale;
	}
	return fontSize;
}

function setHeaderScale() {
	"use strict";
	var fSize = setFontScale();
	$('div.name').css('font-size', fSize + '%');
	$('div.name').css('line-height', '125%');
}

/// This function makes a new named window with contents from an enternal source
/// It is used to provide the popup contact window with a contact form from the IU Journalism website

function newWindow(mypage, myname, w, h, scroll) {
	"use strict";
    var winl = (screen.width - w) / 2,
		wint = (screen.height - h) / 2,
		winprops = 'height=' + h + ',width=' + w + ',top=' + wint + ',left=' + winl +  ',location=no,directories=no,menubar=no,toolbar=no,scrollbars=' + scroll + ',resizable',
		win = window.open(mypage, myname, winprops);
    if (parseInt(navigator.appVersion, 10) >= 4) { win.window.focus(); }
}

function init_bio() {
	"use strict";
}

function init_research() {
	"use strict";
	$("div.HeadersNoJS").hide();
	$("hr.clearBoth").hide();
	$("#ResearchProjects").accordion({
	    header: 'h3',
	    collapsible: true,
	    active: false,
	    autoHeight: false,
	    navigation: true
	});
	$("#IndividualProjects,#CollaborativeProjects,#PublishedResearch").accordion({
	    header: 'h4',
	    collapsible: true,
	    active: false,
	    autoHeight: false,
	    navigation: true
	});
}

function init_teaching() {
	"use strict";
	$("div.HeadersNoJS").hide();
	$("hr.clearBoth").hide();
	$("#Courses").accordion({
	    header: 'h3',
	    collapsible: true,
	    active: false,
	    autoHeight: false,
	    navigation: true
	});
}

/// Here the vitae page is initialized, content is hidden until revealed by clicking on the buttons.
function init_vitae() {
	"use strict";
	var hcicon = "ui-icon-triangle-1-e", // Header Closed Icon
		hoicon = "ui-icon-triangle-1-s", // Header Open Icon
		vHeaderButtons = $('div#Vitae input[name="vitaecat"][type="checkbox"]'),
		toggleVitaeSection = function () {
			$(this).next().next().slideToggle("fast");
			var icons = $(this).button("option", "icons");
			if (icons.secondary === hcicon) {
				icons.secondary = hoicon;
			} else {
				icons.secondary = hcicon;
			}
			$(this).button("option", "icons", icons);
			$(this).button("refresh");
		};
	$("#hide_all, #show_all").removeClass("hide");
	$("div.HeadersNoJS,div#Vitae > div").hide();

	vHeaderButtons.each(function () {
		var iname = $(this).attr('id');
		$(this).removeClass("hide").prop("checked",false).next().removeClass("vhbnojs");
		$(this).button({
			icons: {
				primary: "ui-icon-" + iname,
				secondary: hcicon
			}
		}).click(toggleVitaeSection);
	});

	$("#show_all").hover(
		function () {
			$(this).attr("src", "pics/show.png");
		},
		function () {
			$(this).attr("src", "pics/show_inactive.png");
		}
	)
		.click(function () {
			vHeaderButtons.not(':checked').click().button("refresh");
		});

	$("#hide_all").hover(
	    function () {
			$(this).attr("src", "pics/hide.png");
	    },
	    function () {
			$(this).attr("src", "pics/hide_inactive.png");
	    }
	)
		.click(
			function () {
				vHeaderButtons.filter(':checked').click().button("refresh");
			}
		);
}

$(window).resize(function () {setHeaderScale(); findDS();});


/// This makes main page tabs work using jQuery; the syntax for adding new tabs is
/// <id>Tab : the tab anchor link
/// where <id> is the tab content holder div id

var myTabs = $(".nav li a"),
	 loadTab = function () {
	 	"use strict";
	 	var tab = $(this).attr("id").slice(0, -3),
	 		tFile = tab + "\/" + tab.toLowerCase() + ".shtml",
	 		tFunc = window["init_" + tab.toLowerCase()],
	 		tHoldSel = $("#" + tab + "Holder"),
	 		ntab = myTabs.index(this);
	 	if(!($(this).hasClass("activeTab"))) {
	 		tHoldSel.load(tFile, function() {
	 			"use strict";
	 			tFunc();
	 			setTabSect(ntab, tab);
	 		});
	 		$(this).addClass("activeTab");
	 	}
	 	return false;
	 },
	 setTabSect = function (ntab,tab) {
		"use strict";
		var tDivSel = $("#" + tab),
			os = tDivSel.offset(),
			tDir = "left";
			myTabs.each(function () {
				"use strict";
					var otab = $(this).attr("id").slice(0,-3);
					if ($(this).hasClass("activeTab") && otab !== tab) {
						if (ntab < myTabs.index(this)) { tDir = "right"; }
						$(this).removeClass("activeTab");
						$("#" + otab  ).hide("slide", { direction: tDir }, "slow");
						return false;
				}
			});
			tDir = (tDir === "left")? "right" : "left"; 
			tDivSel.show("slide", { direction: tDir },"slow");
			if ($(window).width() < 600 && $(window).height() < 600 ) {
				if(tab !== "Vitae") {
					window.scroll(0, $("#mainBlurbs").outerHeight(true));
				} else {
					window.scroll(0,0);
				}
				$(window).scroll();
			}					
		};

myTabs.click(loadTab);

$("ul.sec_nav li a").click(function () {
	var mode = swDML($(this));
	if (!mode) return false;
   $("body").hide();
   swDS(mode);
   $("body").fadeIn(1000,"easeInCirc");
	return false;	
});
 


function loadContactForm() {
	"use strict";
	newWindow('https://journalism.indiana.edu/libraries/template_library/pop_ups/contact_window.php?person=1177', 'info', '640', '400', 'yes');
	return false;
}

$("#ContactLink").click(loadContactForm);

$("#ContactMe").button({
	label: "Contact",
	icons: {
	    primary: "ui-icon-mail-open",
	    secondary: "ui-icon-newwin"
	}
}).click(loadContactForm);


$(function () {
	"use strict";
	$('ul.nav li a').removeAttr("href");	
	$("#BioTab").removeClass("activeTab").click();
	$("div#mainBlurbs").hide().fadeIn(1000);//(1000, "easeInExpo");
	$("div.name span.first, div.name span.last").show(); // Use text for the name header with a javascript based dynamic resizing function 
	$("img.name").hide(); // Hide the name image
	setHeaderScale();     // the function for dynamic resizing of the header based on window size
	findDS(); // which dispay style is active
	$("button#ContactMe").removeClass("ui-helper-hidden-accessible"); // Show the contact button which pops up the IU Journalism contact form
	if(navigator.platform == 'iPad' || navigator.platform == 'iPhone' || navigator.platform == 'iPod')
	{
		$(window).scroll(function () {
			$('#top_navigation').offset({top: $(window).scrollTop(), left: $(window).scrollLeft()});
//		window.onscroll = function() {
//  			document.getElementById('top_navigation').style.top = (window.pageYOffset) + 'px';
		});
	}
});
